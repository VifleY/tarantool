add_custom_target(ragel
    WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
    COMMAND ragel -G2 src/lib/uri/uri.rl -o src/lib/uri/uri.c)

if (CC_HAS_WNO_IMPLICIT_FALLTHROUGH)
    # Suppress noise warnings for autogenerated Ragel code
    set_source_files_properties(uri.c PROPERTIES COMPILE_FLAGS
        -Wno-implicit-fallthrough)
endif()
add_library(uri STATIC uri.c)

if(ENABLE_FUZZER)
    set(TestName "test_uri")
    add_executable(${TestName} ${TestName}.c)
    add_compile_options(-fsanitize=fuzzer,address -g -O1)
    set_target_properties(${TestName}
            PROPERTIES
            COMPILE_FLAGS "-fsanitize=fuzzer,address -g -O1"
            LINK_FLAGS "-fsanitize=fuzzer,address")
    target_link_libraries(${TestName} PRIVATE uri)
    set_target_properties(${TestName} PROPERTIES RUNTIME_OUTPUT_DIRECTORY "${TESTING_OUTPUT_DIRECTORY}")
endif()
